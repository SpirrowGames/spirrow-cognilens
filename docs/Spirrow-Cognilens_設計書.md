# Spirrow-Cognilens 仕様設計書

## 概要

| 項目 | 内容 |
|------|------|
| **名前** | Spirrow-Cognilens |
| **世界観** | 認知のレンズ |
| **役割** | 情報圧縮・要約サービス |
| **コンセプト** | 「情報の本質を見抜き、圧縮する」 |

## 目的

AIワークフローにおけるコンテキストウィンドウの効率的な活用を実現する。
大量の情報を本質を失わずに圧縮・要約し、LLMへの入力を最適化する。

## 機能要件

### コア機能

1. **テキスト圧縮**
   - 長文ドキュメントの要約
   - 冗長な表現の削減
   - 本質的な情報の抽出

2. **コンテキスト最適化**
   - コンテキストウィンドウサイズに応じた圧縮率調整
   - 重要度に基づく情報の優先順位付け
   - 段階的圧縮（複数レベル）

3. **フォーマット変換**
   - 構造化データへの変換
   - 箇条書き・表形式への整理
   - メタデータ抽出

### API エンドポイント

```
POST /compress
  - text: 圧縮対象テキスト
  - target_ratio: 目標圧縮率 (0.1-1.0)
  - preserve_structure: 構造保持フラグ

POST /summarize
  - text: 要約対象テキスト
  - max_tokens: 最大トークン数
  - style: 要約スタイル (brief/detailed/bullet)

GET /health
  - ヘルスチェック
```

## 技術仕様

### 依存関係

| サービス | 用途 |
|----------|------|
| Spirrow-Lexora | LLM推論基盤 |

### 技術スタック

- **言語**: Python 3.11+
- **フレームワーク**: FastAPI
- **LLM連携**: Lexora API経由

### ポート

- デフォルト: `8003`

## アーキテクチャ

```
┌─────────────────────────────────────────┐
│           Spirrow-Cognilens             │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐    │
│  │     Compression Engine          │    │
│  │  ├── Text Analyzer              │    │
│  │  ├── Importance Scorer          │    │
│  │  └── Summary Generator          │    │
│  └─────────────────────────────────┘    │
│                  │                       │
│                  ▼                       │
│  ┌─────────────────────────────────┐    │
│  │     Lexora Client               │    │
│  │     (LLM API呼び出し)           │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
                   │
                   ▼
        ┌───────────────────┐
        │  Spirrow-Lexora   │
        │   (LLM基盤)       │
        └───────────────────┘
```

## 設定ファイル

```yaml
# cognilens_config.yaml

server:
  host: "0.0.0.0"
  port: 8003

lexora:
  url: "http://localhost:8001"
  timeout: 30

compression:
  default_ratio: 0.3
  min_ratio: 0.1
  max_ratio: 0.9

summarization:
  default_max_tokens: 500
  styles:
    brief: "1-2文で要約"
    detailed: "重要なポイントを網羅"
    bullet: "箇条書き形式"
```

## ユースケース

### 1. MCPサーバー出力の圧縮
```
入力: 大量のファイルリスト出力 (10,000トークン)
処理: Cognilensで圧縮
出力: 重要なファイルのみ抽出 (1,000トークン)
```

### 2. ドキュメント要約
```
入力: 技術ドキュメント全文
処理: 段階的要約
出力: エグゼクティブサマリー
```

### 3. 会話履歴圧縮
```
入力: 長い会話ログ
処理: コンテキスト保持圧縮
出力: 重要な決定事項のみ
```

## 今後の拡張

- [ ] マルチモーダル対応（画像→テキスト要約）
- [ ] カスタム圧縮ルール定義
- [ ] 圧縮品質の自動評価機能
- [ ] Prismindとの連携（圧縮結果のRAG蓄積）

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
